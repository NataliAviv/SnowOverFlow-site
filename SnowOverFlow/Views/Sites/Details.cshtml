@model SnowOverFlow.Models.Site

@{
    ViewData["Title"] = "Details";
}
<!--
    <script src="https://rawgit.com/chen0040/js-recommender/master/build/jsrecommender.min.js" type="application/javascript"></script>
-->
<style>
    .weather {
        width: 100%;
        height: 62px;
    }

        .weather .weather-container {
            position: relative;
            border-radius: 6px;
            display: flex;
            flex-direction: row;
            justify-content: space-between;
            padding: 8px;
            background-image: linear-gradient(to bottom, #7db9e8 0%, #207cca 45%, #207cca 55%, #7db9e8 100%);
        }

            .weather .weather-container .weather-left {
                display: block;
            }

            .weather .weather-container img {
                position: absolute;
                left: 0px;
                right: 0px;
                top: -38px;
                z-index: 50;
                margin: auto;
            }

            .weather .weather-container table {
                font-weight: 600;
                font-size: 18px;
                line-height: 1.3;
                font-family: Oswald, Arial, sans-serif !important;
                color: #333;
            }

                .weather .weather-container table .min-temp {
                    border-right: 2px solid #ff4f98;
                    padding-right: 5px;
                }

                .weather .weather-container table .max-temp {
                    padding: 5px 0 5px 5px;
                }
</style>
<style>
    a {
        text-decoration:none;
        color:inherit;
    }
    a:hover {
        text-decoration: none;
        color: inherit;
    }
    .card {
        display: inline-block;
        box-shadow: 0 1px 2px 0 rgba(0, 0, 0, .15);
        margin: 20px;
        position: relative;
        margin-bottom: 50px;
        transition: all 0.2s ease-in-out;
    }

        .card:hover {
            /*box-shadow: 0 5px 22px 0 rgba(0,0,0,.25);*/
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.19), 0 6px 6px rgba(0, 0, 0, 0.23);
            margin-bottom: 54px;
        }

    .image {
        height: 150px;
        opacity: 0.7;
        overflow: hidden;
        transition: all 0.2s ease-in-out;
    }

        .image:hover, .card:hover .image {
            height: 150px;
            opacity: 1;
        }

    .text {
        background: #fff;
        padding: 20px;
        min-height: 200px;
    }

        .text p {
            margin-bottom: 0px;
        }

    .fab {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        position: absolute;
        margin-top: -50px;
        right: 20px;
        box-shadow: 0px 2px 6px rgba(0, 0, 0, .3);
        color: #fff;
        font-size: 48px;
        line-height: 48px;
        text-align: center;
        background: #0066a2;
        -webkit-transition: -webkit-transform 0.2s ease-in-out;
        transition: transform 0.2s ease-in-out;
    }

        .fab:hover {
            background: #549d3c;
            cursor: pointer;
            -ms-transform: rotate(90deg);
            -webkit-transform: rotate(90deg);
            transform: rotate(90deg);
        }

</style>
<h2>Details</h2>
<div>
    <h4>Site</h4>
    <div class="weather">
        <div class="weather-container">
            <div class="weather-left">
                <div class="weather-country" id="weather-country"></div>
                <div class="weather-desc" id="weather-desc"></div>
            </div>
            <img id="weather-pic" />
            <table>
                <tbody>
                    <tr>
                        <td class="min-temp" id="min-temp"></td>
                        <td class="max-temp" id="max-temp"></td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
    <div id="googleMap" style="height:400px;width:100%;"></div>
    <hr />
    <dl class="dl-horizontal">
        <dt>
            @Html.DisplayNameFor(model => model.Name)
        </dt>
        <dd>
            @Html.DisplayFor(model => model.Name)
        </dd>
        <dt>
            @Html.DisplayNameFor(model => model.Rank)
        </dt>
        <dd>
            @Html.DisplayFor(model => model.Rank)
        </dd>
        <dt>
            @Html.DisplayNameFor(model => model.SeasonStart)
        </dt>
        <dd>
            @Html.DisplayFor(model => model.SeasonStart)
        </dd>
        <dt>
            @Html.DisplayNameFor(model => model.SeasonEnd)
        </dt>
        <dd>
            @Html.DisplayFor(model => model.SeasonEnd)
        </dd>
        <dt>
            @Html.DisplayNameFor(model => model.Latitude)
        </dt>
        <dd>
            @Html.DisplayFor(model => model.Latitude)
        </dd>
        <dt>
            @Html.DisplayNameFor(model => model.Longtitude)
        </dt>
        <dd>
            @Html.DisplayFor(model => model.Longtitude)
        </dd>
        <dt>
            @Html.DisplayNameFor(model => model.Pistes)
        </dt>
        <dd>
            @Html.DisplayFor(model => model.Pistes)
        </dd>
        <dt>
            @Html.DisplayNameFor(model => model.Difficulty)
        </dt>
        <dd>
            @Html.DisplayFor(model => model.Difficulty)
        </dd>
        <dt>
            @Html.DisplayNameFor(model => model.BeerPrice)
        </dt>
        <dd>
            @Html.DisplayFor(model => model.BeerPrice)
        </dd>
        <dt>
            @Html.DisplayNameFor(model => model.Country)
        </dt>
        <dd>
            @Html.DisplayFor(model => model.Country.Name)
        </dd>
    </dl>
</div>
<div class="recommendation-block">If you liked this site you will surely love these ones :</div>
<div id="recommendations-sites" style="display:flex">
    
</div>
<div id="disqus_thread"></div>
<div>
<div class="fb-like" data-href="https://www.facebook.com/Snow-Overflow-343155969579083/" data-layout="button" data-action="like" data-size="large" data-show-faces="true" data-share="true"></div><div>
    <a asp-action="Edit" asp-route-id="@Model.ID">Edit</a> |
    <a asp-action="Index">Back to List</a>
</div>

<script>
    var Latitude = '@Model.Latitude';
    var Longtitude = '@Model.Longtitude'
    console.log('model')
    function myMap() {
        var myCenter = new google.maps.LatLng(Latitude, Longtitude);
        var mapProp = { center: myCenter, zoom: 12, scrollwheel: false, draggable: true, mapTypeId: google.maps.MapTypeId.ROADMAP };
        var map = new google.maps.Map(document.getElementById("googleMap"), mapProp);
        var marker = new google.maps.Marker({ position: myCenter });
        marker.setMap(map);
    }
</script>
<script>
    var Latitude = '@Model.Latitude';
        var Longtitude = '@Model.Longtitude';
        var apiKey = '29b418a037f1272b41e867364d2df1d0';
        var city_name;
        var tempMin,tempMax;
        var pressure;
        var wind_speed;
        var country_name;
    var weather_description;
    var weather_icon;
    $(document).ready(function () {

        $.getJSON("https://api.openweathermap.org/data/2.5/weather?&units=metric&lat=" +
            Latitude + "&lon=" + Longtitude + "&appid=" + apiKey, function (data) {
                console.log("ido", data);
                city_name = data["name"];
                country_name = data["sys"]["country"];
                weather_description = data["weather"][0]["description"];
                weather_icon = data["weather"][0].icon;
                tempMin = data["main"].temp_min;
                tempMax = data["main"].temp_max;
                pressure = data["main"]["pressure"];
                wind_speed = data["wind"]["speed"];
                $("#weather-country").html(country_name + ', ' + city_name);
                $("#weather-desc").html(weather_description);
                $("#min-temp").html(tempMin + '°C');
                $("#max-temp").html(tempMax + '°C');
                $("#weather-pic").attr('src', 'https://openweathermap.org/themes/openweathermap/assets/vendor/owm/img/widgets/' + weather_icon + '.png');
                    //'http://openweathermap.org/img/w/' + weather_icon + '.png');

        })
    });

</script>
<script type="text/javascript">
    $(document).ready(function () {
        var id = '@Model.ID';


        $.getJSON("/getLikes", function (data) {
            var recommender = new jsrecommender.Recommender({
                alpha: 0.01, // learning rate
                lambda: 0.0, // regularization parameter
                iterations: 500, // maximum number of iterations in the gradient descent algorithm
                kDim: 2 //
            });
            var meUser = data.user.split("-").join("").substr(0, 14);
            var recommendedIds = [];

            var table = new jsrecommender.Table();
            for (var i = 0; i < data.likes.result.length; i++) {
                table.setCell(data.likes.result[i].siteID.toString(), data.likes.result[i].userID.split("-").join("").substr(0, 14), 1);
            };

            var model = recommender.fit(table);
            console.log(model);

            predicted_table = recommender.transform(table);

            //console.log(predicted_table);

            for (var i = 0; i < predicted_table.columnNames.length; ++i) {
                var user = predicted_table.columnNames[i];
                if (meUser == user) {
                    //console.log('For user: ' + user);
                    for (var j = 0; j < predicted_table.rowNames.length; ++j) {
                        var site = predicted_table.rowNames[j];
                        if (table.getCell(site, user) != 1) {
                            recommendedIds.push(site);
                        }
                        //console.log('Site [' + site + '] has actual rating of ' + Math.round(table.getCell(site, user)));
                        //console.log('Site [' + site + '] is predicted to have rating ' + Math.round(predicted_table.getCell(site, user)));
                    }
                }    
            };
            //build get url
            if (recommendedIds.length >= 1) {
                var urlString = '?siteIds=' + recommendedIds[0];
                for (var i = 1; i < recommendedIds.length; i++) {
                    urlString += '&siteIds=' + recommendedIds[i];
                }
            }

            $.getJSON("/site/getSites" + urlString, function (data) {
                var recommendations ='';
                console.log("ido|", data);
                for (var i = 0; i < data.length; i++) {
                    recommendations += 
                    '<a href="/sites/Details/' + data[i].id + '">' +
                    '<div class="col-md-6 col-sm-8 col-xs-12 col-md-offset-3 col-sm-offset-2">' +
                        '<div class="card">' +
                            '<div class="image">' +
                                `<img src='/images/snowboard.jpg' width='100%' />` +
                            '</div>' +
                            '<div class="text">' +
                                '<div class="fab">&#43;</div>' +
                                '<h3>' + data[i].name + '</h3>' +
                                '<p>' +
                                    '<ul>' +
                                        '<li>Pistes :' + data[i].pistes + '</li>' +
                                        '<li>Rank :' + data[i].rank + '</li>' +
                                        '<li>Difficulty :' + data[i].difficulty + '</li>' +
                                    '</ul>' +
                                '</p>' +
                            '</div>' +
                        '</div>' +
                    '</div>' +
                    '</a>';
                }
                $('#recommendations-sites').html(recommendations);
            });

           
                })
        });
</script>
<!-- Start Facebook Share & Like Button -->
<div id="fb-root"></div>
<script>
    (function (d, s, id) {
        var js, fjs = d.getElementsByTagName(s)[0];
        if (d.getElementById(id)) return;
        js = d.createElement(s); js.id = id;
        js.src = 'https://connect.facebook.net/en_US/sdk.js#xfbml=1&version=v3.2';
        fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));
</script>
<!-- End Facebook Share & Like Button -->


<script>

    /**
    *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
    *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
    /*
    var disqus_config = function () {
    this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
    this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
    */
    (function () { // DON'T EDIT BELOW THIS LINE
        var d = document, s = d.createElement('script');
        s.src = 'https://snowoverflow.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<script src='//openweathermap.org/themes/openweathermap/assets/vendor/owm/js/d3.min.js'></script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD9U27ZROmVD4qAONCZEM5QD0OJydE0Sz0&callback=myMap"></script>





